{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/arijs/Desktop/Application/Frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { catchError, throwError, BehaviorSubject, tap, of } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class LoginService {\n  constructor(http) {\n    this.http = http;\n    this.apiUrl = 'http://localhost:8000/api/user';\n    this.isAuthenticate = false;\n    this.isAuthenticatedSubject = new BehaviorSubject(false);\n  }\n  login(username, password) {\n    const body = {\n      username,\n      password\n    };\n    return this.http.post(`${this.apiUrl}/login`, body, {\n      withCredentials: true\n    }).pipe(tap(() => {\n      this.isAuthenticate = true;\n      this.isAuthenticatedSubject.next(true);\n    }));\n  }\n  getUsername(userId) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const url = `${_this.apiUrl}/username/${userId}`;\n      const response = yield _this.http.get(url).toPromise();\n      return response?.username ?? '';\n    })();\n  }\n  getCookie(name) {\n    const cookies = document.cookie;\n    if (cookies) {\n      return cookies;\n    }\n    return '';\n  }\n  isLoggedIn() {\n    return this.isAuthenticate;\n  }\n  logout() {\n    const httpOptions = {\n      withCredentials: true // Include cookies in the request\n    };\n\n    return this.http.post(`${this.apiUrl}/logout`, {}, httpOptions).pipe(tap(() => {\n      this.isAuthenticate = false;\n      this.isAuthenticatedSubject.next(false);\n    }), catchError(error => {\n      console.error('Logout error:', error);\n      return throwError(error);\n    }));\n  }\n  checkAuthentication() {\n    return this.http.get(`${this.apiUrl}/protected`, {\n      withCredentials: true\n    }).pipe(catchError(() => of(false)), tap(isAuthenticated => {\n      this.isAuthenticatedSubject.next(isAuthenticated);\n    }));\n  }\n  isAuthenticated() {\n    return this.isAuthenticatedSubject.asObservable();\n  }\n}\nLoginService.ɵfac = function LoginService_Factory(t) {\n  return new (t || LoginService)(i0.ɵɵinject(i1.HttpClient));\n};\nLoginService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: LoginService,\n  factory: LoginService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"names":["catchError","throwError","BehaviorSubject","tap","of","LoginService","constructor","http","apiUrl","isAuthenticate","isAuthenticatedSubject","login","username","password","body","post","withCredentials","pipe","next","getUsername","userId","_this","_asyncToGenerator","url","response","get","toPromise","getCookie","name","cookies","document","cookie","isLoggedIn","logout","httpOptions","error","console","checkAuthentication","isAuthenticated","asObservable","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["C:\\Users\\arijs\\Desktop\\Application\\Frontend\\src\\app\\services\\login.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, catchError, throwError ,BehaviorSubject, tap, of} from 'rxjs';\r\n\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class LoginService {\r\n  private apiUrl = 'http://localhost:8000/api/user';\r\n  private isAuthenticate = false;\r\n  private isAuthenticatedSubject = new BehaviorSubject<boolean>(false);\r\n\r\n  constructor(private http: HttpClient) { }\r\n\r\n  login(username: string, password: string): Observable<any> {\r\n    const body = { username, password };\r\n    return this.http.post(`${this.apiUrl}/login`, body, { withCredentials: true})\r\n      .pipe(\r\n        tap(() => {\r\n          this.isAuthenticate = true;\r\n          this.isAuthenticatedSubject.next(true);\r\n        })\r\n      );\r\n  }\r\n  async getUsername(userId: string): Promise<string> {\r\n    const url = `${this.apiUrl}/username/${userId}`;\r\n    const response = await this.http.get<{ username: string }>(url).toPromise();\r\n    return response?.username ?? '';\r\n  }\r\n  \r\n  \r\n  getCookie(name: string): string {\r\n    const cookies = document.cookie\r\n    if (cookies) {\r\n      return cookies;\r\n    }\r\n    return '';\r\n  }\r\n  isLoggedIn(): boolean {\r\n    return this.isAuthenticate;\r\n  }\r\n  logout(): Observable<any> {\r\n    const httpOptions = {\r\n      withCredentials: true // Include cookies in the request\r\n    };\r\n  \r\n    return this.http.post<any>(`${this.apiUrl}/logout`, {}, httpOptions)\r\n      .pipe(\r\n        tap(() => {\r\n          this.isAuthenticate = false;\r\n          this.isAuthenticatedSubject.next(false);\r\n        }),\r\n        catchError((error: any) => {\r\n          console.error('Logout error:', error);\r\n          return throwError(error);\r\n        })\r\n      );\r\n  }\r\n  checkAuthentication(): Observable<boolean> {\r\n    return this.http.get<boolean>(`${this.apiUrl}/protected`, { withCredentials: true })\r\n      .pipe(\r\n        catchError(() => of(false)),\r\n        tap((isAuthenticated) => {\r\n          this.isAuthenticatedSubject.next(isAuthenticated);\r\n        })\r\n      );\r\n  }\r\n  isAuthenticated(): Observable<boolean> {\r\n    return this.isAuthenticatedSubject.asObservable();\r\n  }\r\n\r\n}\r\n"],"mappings":";AAEA,SAAqBA,UAAU,EAAEC,UAAU,EAAEC,eAAe,EAAEC,GAAG,EAAEC,EAAE,QAAO,MAAM;;;AAMlF,OAAM,MAAOC,YAAY;EAKvBC,YAAoBC,IAAgB;IAAhB,KAAAA,IAAI,GAAJA,IAAI;IAJhB,KAAAC,MAAM,GAAG,gCAAgC;IACzC,KAAAC,cAAc,GAAG,KAAK;IACtB,KAAAC,sBAAsB,GAAG,IAAIR,eAAe,CAAU,KAAK,CAAC;EAE5B;EAExCS,KAAKA,CAACC,QAAgB,EAAEC,QAAgB;IACtC,MAAMC,IAAI,GAAG;MAAEF,QAAQ;MAAEC;IAAQ,CAAE;IACnC,OAAO,IAAI,CAACN,IAAI,CAACQ,IAAI,CAAC,GAAG,IAAI,CAACP,MAAM,QAAQ,EAAEM,IAAI,EAAE;MAAEE,eAAe,EAAE;IAAI,CAAC,CAAC,CAC1EC,IAAI,CACHd,GAAG,CAAC,MAAK;MACP,IAAI,CAACM,cAAc,GAAG,IAAI;MAC1B,IAAI,CAACC,sBAAsB,CAACQ,IAAI,CAAC,IAAI,CAAC;IACxC,CAAC,CAAC,CACH;EACL;EACMC,WAAWA,CAACC,MAAc;IAAA,IAAAC,KAAA;IAAA,OAAAC,iBAAA;MAC9B,MAAMC,GAAG,GAAG,GAAGF,KAAI,CAACb,MAAM,aAAaY,MAAM,EAAE;MAC/C,MAAMI,QAAQ,SAASH,KAAI,CAACd,IAAI,CAACkB,GAAG,CAAuBF,GAAG,CAAC,CAACG,SAAS,EAAE;MAC3E,OAAOF,QAAQ,EAAEZ,QAAQ,IAAI,EAAE;IAAC;EAClC;EAGAe,SAASA,CAACC,IAAY;IACpB,MAAMC,OAAO,GAAGC,QAAQ,CAACC,MAAM;IAC/B,IAAIF,OAAO,EAAE;MACX,OAAOA,OAAO;;IAEhB,OAAO,EAAE;EACX;EACAG,UAAUA,CAAA;IACR,OAAO,IAAI,CAACvB,cAAc;EAC5B;EACAwB,MAAMA,CAAA;IACJ,MAAMC,WAAW,GAAG;MAClBlB,eAAe,EAAE,IAAI,CAAC;KACvB;;IAED,OAAO,IAAI,CAACT,IAAI,CAACQ,IAAI,CAAM,GAAG,IAAI,CAACP,MAAM,SAAS,EAAE,EAAE,EAAE0B,WAAW,CAAC,CACjEjB,IAAI,CACHd,GAAG,CAAC,MAAK;MACP,IAAI,CAACM,cAAc,GAAG,KAAK;MAC3B,IAAI,CAACC,sBAAsB,CAACQ,IAAI,CAAC,KAAK,CAAC;IACzC,CAAC,CAAC,EACFlB,UAAU,CAAEmC,KAAU,IAAI;MACxBC,OAAO,CAACD,KAAK,CAAC,eAAe,EAAEA,KAAK,CAAC;MACrC,OAAOlC,UAAU,CAACkC,KAAK,CAAC;IAC1B,CAAC,CAAC,CACH;EACL;EACAE,mBAAmBA,CAAA;IACjB,OAAO,IAAI,CAAC9B,IAAI,CAACkB,GAAG,CAAU,GAAG,IAAI,CAACjB,MAAM,YAAY,EAAE;MAAEQ,eAAe,EAAE;IAAI,CAAE,CAAC,CACjFC,IAAI,CACHjB,UAAU,CAAC,MAAMI,EAAE,CAAC,KAAK,CAAC,CAAC,EAC3BD,GAAG,CAAEmC,eAAe,IAAI;MACtB,IAAI,CAAC5B,sBAAsB,CAACQ,IAAI,CAACoB,eAAe,CAAC;IACnD,CAAC,CAAC,CACH;EACL;EACAA,eAAeA,CAAA;IACb,OAAO,IAAI,CAAC5B,sBAAsB,CAAC6B,YAAY,EAAE;EACnD;;AA9DWlC,YAAY,C;mBAAZA,YAAY,EAAAmC,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA;AAAA;AAAZtC,YAAY,C;SAAZA,YAAY;EAAAuC,OAAA,EAAZvC,YAAY,CAAAwC,IAAA;EAAAC,UAAA,EAFX;AAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}